<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="How to Push a Custom Test Command Line to Try" />
<meta property="og:description" content="OUTDATED

The steps in this article are no longer accurate. Pushing a custom command line is easier now. See
here for more details.



Have you ever wanted to see the test results of a custom command line in try? Things like
&ndash;test-manifest, &ndash;shuffle or &ndash;run-slower?  Now you can! The process isn&rsquo;t exactly optimized for
the developer use case, but neither is it really difficult to do once you know how.

" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ahal.ca/blog/2013/push-custom-test-command-line-try/" />



<meta property="article:published_time" content="2013-07-24T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2013-07-24T00:00:00&#43;00:00"/>











<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="How to Push a Custom Test Command Line to Try"/>
<meta name="twitter:description" content="OUTDATED

The steps in this article are no longer accurate. Pushing a custom command line is easier now. See
here for more details.



Have you ever wanted to see the test results of a custom command line in try? Things like
&ndash;test-manifest, &ndash;shuffle or &ndash;run-slower?  Now you can! The process isn&rsquo;t exactly optimized for
the developer use case, but neither is it really difficult to do once you know how.

"/>
<meta name="generator" content="Hugo 0.42" />


    
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "How to Push a Custom Test Command Line to Try",
  "url": "https://ahal.ca/blog/2013/push-custom-test-command-line-try/",
  "wordCount": "451",
  "datePublished": "2013-07-24T00:00:00&#43;00:00",
  "dateModified": "2013-07-24T00:00:00&#43;00:00",
  "author": {
    "@type": "Person",
    "name": "Andrew Halberstadt"
  },
  "keywords": "ateam, mozharness, mozilla"
}
</script>



    <link rel="canonical" href="https://ahal.ca/blog/2013/push-custom-test-command-line-try/">

    <title>How to Push a Custom Test Command Line to Try | Hunting the Shmoo</title>

    <!-- combined, minified CSS -->
    <link href="https://ahal.ca/css/style.css" rel="stylesheet" integrity="sha384-TbfEhJn4HkgPUIZUhhHaAYsycYKHxSuIloCjZOiyCSpbVunRQxg5T5pxKVFwxilF" crossorigin="anonymous">

    

    

    

    <link rel="shortcut icon" href="/favicon.png">
<link href="https://ahal.ca/css/bootstrap.min.css" rel="stylesheet">
<link href="https://ahal.ca/css/override.css" rel="stylesheet">
<link href="https://ahal.ca/css/debugprint.css" rel="stylesheet">
<script type="text/javascript" src="/js/menu.js"></script>

  </head>

  <body>

    
    <div class="blog-masthead">
      <div class="container">
        <nav class="nav blog-nav">
          <a class="nav-link " href="https://ahal.ca/">Home</a>
          
          <a class="nav-link active" href="/blog/" title="">Blog</a>
          
          
          <a class="nav-link" href="/casts/" title="">Casts</a>
          
        </nav>
      </div>
    </div>
    

    
    <header class="blog-header">
      <div class="container">
        <h1 class="blog-title"><a href="https://ahal.ca/" rel="home">Hunting the Shmoo</a></h1>
        <p class="lead blog-description">Screencasts and blog posts on workflow, productivity, tools, Mozilla and whatever else tickles my fancy.</p>
      </div>
    </header>
    

    
    <div class="container">
      <div class="row">
        <div class="col-sm-8 blog-main">

          


<article class="blog-post">
  <header>
    <h2 class="blog-post-title"><a href="https://ahal.ca/blog/2013/push-custom-test-command-line-try/">How to Push a Custom Test Command Line to Try</a></h2>
    <p class="blog-post-meta"><time datetime="2013-07-24T00:00:00Z">Jul 24, 2013</time> by Andrew Halberstadt in 

<i class="fa fa-tag" aria-hidden="true"></i>&nbsp;<a href="/tags/ateam" rel="tag">ateam</a>, <a href="/tags/mozharness" rel="tag">mozharness</a>, <a href="/tags/mozilla" rel="tag">mozilla</a>

</p>
  </header>
  <h3 id="outdated">OUTDATED</h3>

<p>The steps in this article are no longer accurate. Pushing a custom command line is easier now. See
<a href="https://groups.google.com/forum/#!topic/mozilla.dev.platform/AKDyoQShFEs">here</a> for more details.</p>

<hr />

<p>Have you ever wanted to see the test results of a custom command line in try? Things like
&ndash;test-manifest, &ndash;shuffle or &ndash;run-slower?  Now you can! The process isn&rsquo;t exactly optimized for
the developer use case, but neither is it really difficult to do once you know how.</p>

<p></p>

<p>Basically, you just edit the &lsquo;testing/config/mozharness_config.py&rsquo; file. Add a new key called
&lsquo;&lt;test_suite&gt;_options&rsquo; and set its value to a list containing the <b>full command line</b> you
want to pass into the test suite. Substitute &lsquo;&lt;test_suite&gt;&rsquo; with the name of the test suite
(e.g mochitest, reftest, xpcshell etc). It&rsquo;s important to note that there is no way to simply extend
the official list, doing this will replace the original list wholesale.</p>

<p>For example, lets say I wanted to add the &ndash;shuffle option to all mochitests, my diff would be:</p>

<pre><code>diff --git a/testing/config/mozharness_config.py b/testing/config/mozharness_config.py
--- a/testing/config/mozharness_config.py
+++ b/testing/config/mozharness_config.py
@@ -20,9 +20,15 @@ mochitests.
 
 You must also provide the complete command line to avoid errors. The official
 configuration files containing the default values live in:
     https://hg.mozilla.org/build/mozharness/configs
 &quot;&quot;&quot;
 
 config = {
     # Add custom mozharness config options here
+    &quot;mochitest_options&quot;: [
+        &quot;--appname=%(binary_path)s&quot;, &quot;--utility-path=tests/bin&quot;,
+        &quot;--extra-profile-file=tests/bin/plugins&quot;, &quot;--symbols-path=%(symbols_path)s&quot;,
+        &quot;--certificate-path=tests/certs&quot;, &quot;--autorun&quot;, &quot;--close-when-done&quot;,
+        &quot;--console-level=INFO&quot;, &quot;--setpref=webgl.force-enabled=true&quot;, &quot;--shuffle&quot;,
+    ],
 }
</code></pre>

<p>There are a few limitatons to this system I want to call out.</p>

<ol>
<li>You need to know the official options to use as a baseline for your changes. You can inspect official command lines by looking at the mozharness repo:
<ul>
<li>Windows: <a href="/web/20150907231521/http://mxr.mozilla.org/build/source/mozharness/configs/unittests/win_unittest.py">http://mxr.mozilla.org/build/source/mozharness/configs/unittests/win_unittest.py</a></li>
<li>OSX: <a href="/web/20150907231521/http://mxr.mozilla.org/build/source/mozharness/configs/unittests/mac_unittest.py">http://mxr.mozilla.org/build/source/mozharness/configs/unittests/mac_unittest.py</a></li>
<li>Linux: <a href="/web/20150907231521/http://mxr.mozilla.org/build/source/mozharness/configs/unittests/linux_unittest.py">http://mxr.mozilla.org/build/source/mozharness/configs/unittests/linux_unittest.py</a></li>
<li>B2G: <a href="/web/20150907231521/http://mxr.mozilla.org/build/source/mozharness/configs/b2g/emulator_automation_config.py">http://mxr.mozilla.org/build/source/mozharness/configs/b2g/emulator_automation_config.py</a></li>
</ul>
Note: Android doesn't currently use mozharness so this trick is not yet possible on Fennec.
</li>
<li>There is no way to specify separate command lines for different platforms. For example the mochitest command lines for B2G and desktop are very different. There is no way to specify a custom command line 
for one without breaking the other. To get around this you'll just need to do two separate try pushes with two separate command lines.</li>
<li>Certain options (like --this-chunk and --total-chunks) might confuse the automation and have unintended consequences. For example specifying '--this-chunk 1' will tell every job (even chunks 2+) to run the first chunk.</li>
</ol>

<p>In conclusion, there are many things we can do to make this easier for developers. The current
solution was really implemented to allow tree specific mozharness config values, the fact that you
can push custom command lines to try was just a useful side effect. I hope in the future someone
will make the developer story around this less confusing, but I&rsquo;m not sure how high of a priority it
is at the moment.</p>

  

  
  <hr>
  <footer>

  
    <section>
    <h4>Share</h4>
    <nav class="nav sharing-icons">
      <a class="nav-item" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fahal.ca%2fblog%2f2013%2fpush-custom-test-command-line-try%2f" title="Share on Facebook"><span class="fa fa-facebook fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://plus.google.com/share?url=https%3a%2f%2fahal.ca%2fblog%2f2013%2fpush-custom-test-command-line-try%2f" title="Share on Google+"><span class="fa fa-google-plus fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fahal.ca%2fblog%2f2013%2fpush-custom-test-command-line-try%2f" title="Share on LinkedIn"><span class="fa fa-linkedin fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://twitter.com/home?status=https%3a%2f%2fahal.ca%2fblog%2f2013%2fpush-custom-test-command-line-try%2f" title="Tweet this"><span class="fa fa-twitter fa-2x"></span></a>
    </nav>
  </section>

  

  

  
    <section class="post-comments">
      














































      <br>
      <h4>Leave a comment</h4>
<form class="post-new-comment" method="POST" action="https://api.staticman.net/v2/entry/ahal/hunting-the-shmoo/master/comments">
    <input type="hidden" name="options[redirect]" value="https://ahal.ca/blog/2013/push-custom-test-command-line-try/#comment-submitted">
    <input type="hidden" name="options[slug]" value="push-custom-test-command-line-try">
    <input class="post-comment-field" name="fields[name]" type="text" placeholder="Name (required)">
    <input class="post-comment-field" name="fields[email]" type="email" placeholder="E-mail (optional)">
    <textarea class="post-comment-field" name="fields[msg]" placeholder="Message (required, markdown enabled)" rows="10"></textarea>
    <input class="post-comment-field btn" type="submit" value="Submit">
</form>

<div id="comment-submitted">
  <p>Your comment has been submitted and will be published once it has been approved.</p>
</div>

    </section>
  
  </footer>
  

</article> 



        </div> <!-- /.blog-main -->

        <aside class="col-sm-3 ml-auto blog-sidebar">
  

  
        <section class="sidebar-module">
    <h4>Recent Posts</h4>
    <ol class="list-unstyled">


<li><a href="/blog/2019/fragmented-communication/">The Cost of Fragmented Communication</a></li>

<li><a href="/blog/2019/python-3-at-mozilla/">Python 3 at Mozilla</a></li>

<li><a href="/casts/2019/task-configuration-at-scale/">Task Configuration at Scale</a></li>

<li><a href="/casts/2018/taskgraph-like-a-pro/">Taskgraph Like a Pro</a></li>

<li><a href="/blog/2018/website-refresh/">A New Look and Feel (and everything else)</a></li>

<li><a href="/blog/2017/mach-try-fuzzy/">Try Fuzzy: A Try Syntax Alternative</a></li>

<li><a href="/blog/2017/mercurial-absorb/">Absorbing Changes into a Commit Series with Mercurial</a></li>

<li><a href="/blog/2017/fuzzy-try-chooser/">A Course of Action for Replacing Try Syntax</a></li>

<li><a href="/blog/2016/taskcluster-interactive-loaner/">Using One Click Loaner to Debug Failures</a></li>

<li><a href="/blog/2016/zen-of-mach/">The Zen of Mach</a></li>

    </ol>
  </section>

  

  

  
  <section class="sidebar-module tag-cloud">
    <h4>Tag Cloud</h4>
    
    
        
            
            <a href="/tags/mozilla">mozilla</a>
        
    
        
            
            <a href="/tags/ateam">ateam</a>
        
    
        
            
            <a href="/tags/b2g">b2g</a>
        
    
        
            
            <a href="/tags/mercurial">mercurial</a>
        
    
        
            
            <a href="/tags/mach">mach</a>
        
    
        
            
            <a href="/tags/fzf">fzf</a>
        
    
        
            
            <a href="/tags/programming">programming</a>
        
    
        
            
            <a href="/tags/python">python</a>
        
    
        
            
            <a href="/tags/try">try</a>
        
    
        
            
            <a href="/tags/mozconfigwrapper">mozconfigwrapper</a>
        
    
        
            
            <a href="/tags/mozmill">mozmill</a>
        
    
        
            
            <a href="/tags/taskgraph">taskgraph</a>
        
    
        
            
            <a href="/tags/website">website</a>
        
    
        
            
            <a href="/tags/absorb">absorb</a>
        
    
        
            
            <a href="/tags/addon">addon</a>
        
    
        
            
            <a href="/tags/android">android</a>
        
    
        
            
            <a href="/tags/bookbinder">bookbinder</a>
        
    
        
            
            <a href="/tags/cycling">cycling</a>
        
    
        
            
            <a href="/tags/django">django</a>
        
    
        
            
            <a href="/tags/hugo">hugo</a>
        
    
        
            
            <a href="/tags/jetty">jetty</a>
        
    
        
            
            <a href="/tags/mozharness">mozharness</a>
        
    
        
            
            <a href="/tags/mozprofile">mozprofile</a>
        
    
        
            
            <a href="/tags/music">music</a>
        
    
        
            
            <a href="/tags/peptest">peptest</a>
        
    
        
            
            <a href="/tags/qqver">qqver</a>
        
    
        
            
            <a href="/tags/reddit">reddit</a>
        
    
        
            
            <a href="/tags/reftest">reftest</a>
        
    
        
            
            <a href="/tags/staticman">staticman</a>
        
    
        
            
            <a href="/tags/taskcluster">taskcluster</a>
        
    
        
            
            <a href="/tags/test-informant">test-informant</a>
        
    
        
            
            <a href="/tags/toronto">toronto</a>
        
    
  </section>
  
</aside>


      </div> <!-- /.row -->
    </div> <!-- /.container -->
    

    
    <footer class="blog-footer">
      <p>
      
      © 2018 Andrew Halberstadt
      
      </p>
      <p>
      <a href="#">Back to top</a>
      </p>
    </footer>
    

  </body>

</html>
