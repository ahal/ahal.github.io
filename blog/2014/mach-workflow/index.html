<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="A Workflow for using Mach with multiple Object Directories" />
<meta property="og:description" content="Mach is an amazing tool which facilitates a large number of common user stories in the mozilla
source tree. You can perform initial setup, execute a build, run tests, examine diagnostics, even
search Google. Many of these things require an object directory. This can potentially lead to some
confusion if you typically have more than one object directory at any given time. How does mach know
which object directory to operate on?

" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ahal.ca/blog/2014/mach-workflow/" />



<meta property="article:published_time" content="2014-03-03T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2014-03-03T00:00:00&#43;00:00"/>











<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="A Workflow for using Mach with multiple Object Directories"/>
<meta name="twitter:description" content="Mach is an amazing tool which facilitates a large number of common user stories in the mozilla
source tree. You can perform initial setup, execute a build, run tests, examine diagnostics, even
search Google. Many of these things require an object directory. This can potentially lead to some
confusion if you typically have more than one object directory at any given time. How does mach know
which object directory to operate on?

"/>
<meta name="generator" content="Hugo 0.38.2" />


    
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "A Workflow for using Mach with multiple Object Directories",
  "url": "https://ahal.ca/blog/2014/mach-workflow/",
  "wordCount": "451",
  "datePublished": "2014-03-03T00:00:00&#43;00:00",
  "dateModified": "2014-03-03T00:00:00&#43;00:00",
  "author": {
    "@type": "Person",
    "name": "Andrew Halberstadt"
  },
  "keywords": "ateam, mach, mozconfigwrapper, mozilla"
}
</script>



    <link rel="canonical" href="https://ahal.ca/blog/2014/mach-workflow/">

    <title>A Workflow for using Mach with multiple Object Directories | Hunting the Shmoo</title>

    <!-- combined, minified CSS -->
    <link href="https://ahal.ca/css/style.css" rel="stylesheet" integrity="sha384-ZwlQQbzhEPf3PrXZ3h/XKT/4UHafQ/TYI72AL&#43;7WOJ8D6JmpGC8JMMse6xX7cyeI" crossorigin="anonymous">

    

    

    

    <link rel="shortcut icon" href="/favicon.png">
<link href="https://ahal.ca/css/override.css" rel="stylesheet">
<script type="text/javascript" src="/js/menu.js"></script>

  </head>

  <body>

    
    <div class="blog-masthead">
  <div class="container">
    <nav class="nav blog-nav">
      <a class="nav-link" href="https://ahal.ca/"></a>
      
      <a class="nav-link active" href="/blog/" title="">Blog</a>
      
    </nav>
  </div>
</div>

    

    
    
    

    
    <div class="container">
      <div class="row">
        <div class="col-sm-8 blog-main">

          


<article class="blog-post">
  <header>
    <h2 class="blog-post-title"><a href="https://ahal.ca/blog/2014/mach-workflow/">A Workflow for using Mach with multiple Object Directories</a></h2>
    <p class="blog-post-meta"><time datetime="2014-03-03T00:00:00Z">Mar 03, 2014</time> by Andrew Halberstadt in 

<i class="fa fa-tag" aria-hidden="true"></i>&nbsp;<a href="/tags/ateam" rel="tag">ateam</a>, <a href="/tags/mach" rel="tag">mach</a>, <a href="/tags/mozconfigwrapper" rel="tag">mozconfigwrapper</a>, <a href="/tags/mozilla" rel="tag">mozilla</a>

</p>
  </header>
  <p><a href="https://developer.mozilla.org/en-US/docs/Developer_Guide/mach">Mach</a> is an amazing tool which facilitates a large number of common user stories in the mozilla
source tree. You can perform initial setup, execute a build, run tests, examine diagnostics, even
search Google. Many of these things require an object directory. This can potentially lead to some
confusion if you typically have more than one object directory at any given time. How does mach know
which object directory to operate on?</p>

<p></p>

<p>It turns out that mach is pretty smart. It takes a very good guess at which object directory you
want.  Here is a simplification of the steps in order:</p>

<ol>
<li>If cwd is an objdir or a subdirectory of an objdir, use that</li>
<li>If a mozconfig is detected and MOZ_OBJDIR is in it, use that</li>
<li>Attempt to guess the objdir with build/autoconf/config.guess</li>
</ol>

<p>The cool thing about this is that there are tons of different workflows that fit nicely into this
model. For example, many people put the mach binary on their $PATH and then always make sure to &lsquo;cd&rsquo;
into their objdirs before invoking related mach commands.</p>

<p>It turns out that mach works really well with a tool I had written quite awhile back called
<a href="https://github.com/ahal/mozconfigwrapper">mozconfigwrapper</a>. I won&rsquo;t go into details about mozconfigwrapper here. For more info, see my
<a href="http://ahal.ca/blog/2011/mozconfigwrapper-introduction">previous post</a> on it. Now for the sake of example, let&rsquo;s say we have a regular and debug build
called &lsquo;regular&rsquo; and &lsquo;debug&rsquo; respectively.  Now let&rsquo;s say I wanted to run the &lsquo;mochitest-plain&rsquo; test
suite on each build, one after the other. My workflow would be (from any directory other than an
objdir):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ buildwith regular
$ mach mochitest-plain
$ buildwith debug
$ mach mochitest-plain</code></pre></div>
<p>How does this work? Very simply, mozconfigwrapper is exporting the $MOZCONFIG environment variable
under the hood anytime you call &lsquo;buildwith&rsquo;. Mach will then pick up on this due to the second step
listed above.</p>

<p>Your second question might be why bother installing mozconfigwrapper when you can just export
MOZCONFIG directly? This is a matter of personal preference, but one big reason for me is the
buildwith command has full tab completion, so it is easy to see which mozconfigs you have available
to choose from. Also, since they are hidden away in your home directory, you don&rsquo;t need to memorize
any paths. There are other advantages as well which you can see in the mozconfigwrapper <a href="https://github.com/ahal/mozconfigwrapper">readme</a>.</p>

<p>I&rsquo;ve specially found this workflow useful when building several platforms at once (e.g firefox and
b2g desktop) and switching back and forth between them with a high frequency. In the end, to each
their own and this is just one possible workflow out of many. If you have a different workflow
please feel free to share it in the comments.</p>

  

  
  <hr>
  <footer>

  
    <section>
    <h4>Share</h4>
    <nav class="nav sharing-icons">
      <a class="nav-item" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fahal.ca%2fblog%2f2014%2fmach-workflow%2f" title="Share on Facebook"><span class="fa fa-facebook fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://plus.google.com/share?url=https%3a%2f%2fahal.ca%2fblog%2f2014%2fmach-workflow%2f" title="Share on Google+"><span class="fa fa-google-plus fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fahal.ca%2fblog%2f2014%2fmach-workflow%2f" title="Share on LinkedIn"><span class="fa fa-linkedin fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://twitter.com/home?status=https%3a%2f%2fahal.ca%2fblog%2f2014%2fmach-workflow%2f" title="Tweet this"><span class="fa fa-twitter fa-2x"></span></a>
    </nav>
  </section>

  

  
  <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "ahal" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  
  </footer>
  

</article> 



        </div> <!-- /.blog-main -->

        <aside class="col-sm-3 ml-auto blog-sidebar">
  

  
        <section class="sidebar-module">
    <h4>Recent Posts</h4>
    <ol class="list-unstyled">


<li><a href="/blog/2017/mach-try-fuzzy/">Try Fuzzy: A Try Syntax Alternative</a></li>

<li><a href="/blog/2017/mercurial-absorb/">Absorbing Changes into a Commit Series with Mercurial</a></li>

<li><a href="/blog/2017/fuzzy-try-chooser/">A Course of Action for Replacing Try Syntax</a></li>

<li><a href="/blog/2016/taskcluster-interactive-loaner/">Using One Click Loaner to Debug Failures</a></li>

<li><a href="/blog/2016/zen-of-mach/">The Zen of Mach</a></li>

<li><a href="/blog/2015/try-syntax/">Looking beyond Try Syntax</a></li>

<li><a href="/blog/2015/making-mercurial-bookmarks-more-git-like/">Making mercurial bookmarks more git-like</a></li>

<li><a href="/blog/2015/new-mercurial-workflow-part-2/">The New Mercurial Workflow - Part 2</a></li>

<li><a href="/blog/2014/consume-structured-test-results/">How to Consume Structured Test Results</a></li>

<li><a href="/blog/2014/new-mercurial-workflow/">The New Mercurial Workflow</a></li>

    </ol>
  </section>

  

  

  
  <section class="sidebar-module tag-cloud">
    <h4>Tag Cloud</h4>
    
    
        
            
            <a href="/tags/mozilla">mozilla</a>
        
    
        
            
            <a href="/tags/ateam">ateam</a>
        
    
        
            
            <a href="/tags/b2g">b2g</a>
        
    
        
            
            <a href="/tags/mercurial">mercurial</a>
        
    
        
            
            <a href="/tags/mach">mach</a>
        
    
        
            
            <a href="/tags/programming">programming</a>
        
    
        
            
            <a href="/tags/try">try</a>
        
    
        
            
            <a href="/tags/fzf">fzf</a>
        
    
        
            
            <a href="/tags/mozconfigwrapper">mozconfigwrapper</a>
        
    
        
            
            <a href="/tags/mozmill">mozmill</a>
        
    
        
            
            <a href="/tags/python">python</a>
        
    
        
            
            <a href="/tags/absorb">absorb</a>
        
    
        
            
            <a href="/tags/addon">addon</a>
        
    
        
            
            <a href="/tags/android">android</a>
        
    
        
            
            <a href="/tags/bookbinder">bookbinder</a>
        
    
        
            
            <a href="/tags/cycling">cycling</a>
        
    
        
            
            <a href="/tags/django">django</a>
        
    
        
            
            <a href="/tags/mozharness">mozharness</a>
        
    
        
            
            <a href="/tags/mozprofile">mozprofile</a>
        
    
        
            
            <a href="/tags/music">music</a>
        
    
        
            
            <a href="/tags/peptest">peptest</a>
        
    
        
            
            <a href="/tags/qqver">qqver</a>
        
    
        
            
            <a href="/tags/reddit">reddit</a>
        
    
        
            
            <a href="/tags/reftest">reftest</a>
        
    
        
            
            <a href="/tags/taskcluster">taskcluster</a>
        
    
        
            
            <a href="/tags/test-informant">test-informant</a>
        
    
        
            
            <a href="/tags/toronto">toronto</a>
        
    
  </section>
  
</aside>


      </div> <!-- /.row -->
    </div> <!-- /.container -->
    

    
    <footer class="blog-footer">
  <p>
  
  © 2018 Andrew Halberstadt
  
  </p>
  <p>
  <a href="#">Back to top</a>
  </p>
</footer>

    
  </body>

</html>
